# День 8. Работа с токенами

**Status: DONE**

## Цель

Добавить в систему подсчёт токенов для каждого запроса к модели и ответа, чтобы можно было анализировать и логировать использование токенов по диалогам.

## Что нужно изменить

- Gemini Client (`gemini-client/src/main.py` и связанные модули):
  - При формировании запроса к Gemini вычислять количество токенов в запросе (prompt) и сохранять/логировать это значение.
  - При получении ответа от Gemini вычислять количество токенов в ответе и сохранять/логировать это значение.
- Backend (например, `backend/app/services/chat.py` и/или схемы):
  - При необходимости расширить модели/схемы, чтобы можно было передавать и/или сохранять информацию о токенах запроса и ответа.
  - Обеспечить сквозную передачу информации о токенах (от backend до gemini-client и обратно, если требуется).
- Наблюдаемость:
  - Добавить логирование токенов (request_id, модель, токены запроса и ответа, время обработки) для последующего анализа.

## Критерии приёмки

- [x] Для каждого запроса к модели вычисляется и сохраняется количество токенов запроса.
- [x] Для каждого ответа модели вычисляется и сохраняется количество токенов ответа.
- [x] В логах (gemini-client и/или backend) видно `request_id`, модель и количество токенов для запроса и ответа.
- [x] Реализованы базовые проверки/тесты, подтверждающие корректность подсчёта токенов.
- [x] Все существующие тесты проходят (требуется запуск в Docker).

