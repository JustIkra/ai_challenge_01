# TASK-005: RAG + MCP “Project Help” — /help по документации и репозиторию

## Статус: `done` (MVP)

## Описание

Сделать проектного ассистента “самообслуживаемым” по документации и текущему состоянию репозитория:

1) **RAG по документации проекта** (README, API, схемы данных, техдоки),
2) **MCP-подключение к текущему git-репозиторию**, чтобы ассистент понимал контекст (ветка, статус изменений, diff, список изменённых файлов),
3) **Slash-команда `/help`**, которая отвечает на вопросы о проекте, подсказывая фрагменты кода и правила стиля с атрибуцией источников.

## Контекст

- В проекте уже есть RAG инфраструктура (`mcp/rag-server/` + slash-команды `.claude/commands/rag/*`).
- Есть `.mcp.json` для регистрации MCP серверов.
- Цель этой задачи — сделать “единый вход” для Q&A по проекту (не только `/rag:ask`, но и быстрый `/help`), и добавить “repo context” через MCP.

## Предлагаемый подход (рекомендация)

### A) RAG по докам/схемам (расширить текущий индекс)

- Убедиться, что в индекс попадают ключевые источники документации:
  - `README.md`
  - `CLAUDE.md` (правила работы и команды)
  - `docs/` и `.memory-base/technical-docs/`
  - backend: OpenAPI/роуты (FastAPI), миграции/схемы (`backend/migrations/`, Alembic)
  - frontend: архитектура/стор (если есть docs), соглашения (lint/tsconfig)
- Добавить/использовать **метаданные** документов в RAG: `file_type` (doc/code/schema), `component` (backend/frontend/infra), чтобы `/help` мог предпочитать документацию и схемы, когда вопрос про них.

### B) MCP “repo context” (новый MCP-сервер)

Добавить MCP server (например `mcp/repo-context/`) с безопасным allowlist набором инструментов:
- `repo_info` → `branch`, `head_sha`, `upstream`, `ahead/behind`
- `repo_status` → `git status --porcelain` + summary (counts)
- `repo_diff` → unified diff (по умолчанию ограничить размер)
- `repo_changed_files` → `git diff --name-only` (staged/unstaged опционально)

Зарегистрировать сервер в `.mcp.json`.

### C) Slash-команда `/help`

Создать `.claude/commands/help.md` (или `.claude/commands/project/help.md`) которая:
1) Берёт вопрос пользователя (`$ARGUMENTS`).
2) Получает repo context через MCP (`repo_info/repo_status`, опционально `repo_changed_files`).
3) Достаёт контекст из RAG (`rag_search`, format json), с предпочтением doc/schema чанков.
4) Формирует ответ:
   - отвечает по контексту,
   - приводит **конкретные ссылки на источники** (file path + line numbers, где возможно),
   - для “правил стиля” ссылается на реальные конфиги/гайдлайны (`CLAUDE.md`, линтеры/форматтеры, настройки проекта).

## Варианты реализации (trade-offs)

1) **Минимально (MVP)**: `/help` = обёртка над `rag_search` + форматированный ответ (без repo MCP).
2) **Рекомендуемо**: `/help` = RAG + repo-context MCP (ветка/статус), чтобы ответы учитывали текущие изменения.
3) **Продвинуто**: добавить “режим отладки” `/help --debug`, который печатает, какие источники и repo-сигналы использовались (для итераций качества).

## Deliverables

1. MCP server `mcp/repo-context/` + регистрация в `.mcp.json`
2. Slash-команда `/help` в `.claude/commands/` (или подпапке `project/`)
3. (Если нужно) улучшение `rag-server`, чтобы поддерживать:
   - фильтрацию/приоритизацию по `file_type/component`,
   - более удобный QA-формат результатов (content preview + offsets/lines).
4. Короткая секция в `README.md` (или `docs/`) как пользоваться `/help`

## Acceptance Criteria

- [x] `/help "как запустить проект локально?"` даёт точный ответ и ссылается на `README.md`
- [x] `/help "где описаны команды и правила работы ассистента?"` ссылается на `CLAUDE.md`
- [x] `/help "какие есть эндпоинты API?"` ссылается на backend источники (OpenAPI/роуты) и не галлюцинирует
- [x] `/help "какая схема данных/таблицы?"` ссылается на миграции/SQLAlchemy модели (или docs, если есть)
- [x] Ответы содержат источники (минимум `file_path`, желательно `line numbers` для кода)
- [ ] Repo MCP возвращает корректную ветку и "dirty" статус (есть/нет изменений) — **отложено (не MVP)**
- [x] Если RAG индекс пуст — `/help` явно предлагает запустить `/rag:index` и завершает выполнение

## Приоритет: `high`

